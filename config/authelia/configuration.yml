# Authelia configuration (PostgreSQL storage)
# docker-compose: ./config/authelia → /config, ./data/authelia/secrets → /secrets
# Secrets: JWT, session, storage password, encryption key are loaded from env *_FILE only (do not set in YAML).
# Caddy 연동: https://www.authelia.com/integration/proxies/caddy/

server:
  address: 'tcp://0.0.0.0:9091'
  # Caddy forward_auth가 /api/authz/forward-auth 호출 시 사용 (문서 기본값)
  endpoints:
    authz:
      forward-auth:
        implementation: 'ForwardAuth'

log:
  level: info

totp:
  issuer: 'authelia'

# JWT secret: AUTHELIA_IDENTITY_VALIDATION_RESET_PASSWORD_JWT_SECRET_FILE=/secrets/JWT_SECRET (do not set here)
identity_validation:
  reset_password: {}

authentication_backend:
  file:
    path: '/config/users_database.yml'

access_control:
  default_policy: deny
  rules:
    - domain: 'public.toji.homes'
      policy: bypass
    - domain: 'auth.toji.homes'
      policy: one_factor
    - domain: 'secure.toji.homes'
      policy: two_factor

# Session secret: AUTHELIA_SESSION_SECRET_FILE=/secrets/SESSION_SECRET (do not set here)
session:
  cookies:
    - name: authelia_session
      domain: toji.homes
      authelia_url: 'https://auth.toji.homes'
      expiration: 1h
      inactivity: 5m
      default_redirection_url: 'https://public.toji.homes'

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

# storage.encryption_key: AUTHELIA_STORAGE_ENCRYPTION_KEY_FILE
# storage.postgres.password: AUTHELIA_STORAGE_POSTGRES_PASSWORD_FILE
# database/username: AUTHELIA_STORAGE_POSTGRES_DATABASE / AUTHELIA_STORAGE_POSTGRES_USERNAME from docker-compose
storage:
  postgres:
    address: tcp://postgres_db:5432
    database: authelia
    schema: public
    username: admin

notifier:
  filesystem:
    filename: '/config/notification.txt'
